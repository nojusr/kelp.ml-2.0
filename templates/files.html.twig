{% extends "base.html.twig" %}
{% block links %}
			<a href="/">back</a>
			<a href="/upload">uploads</a>
			{% if session['username'] is defined %}
				<a href="/logout">logout</a>
			{% else %}
				<a href="/pastes">pastes</a>
			{% endif %}
{% endblock %}

{% block content %}
	
	{% if msg is defined %}
		<p class="msg">error: {{ msg }}</p>
	{% endif %}		
	{% if app.session.get('user') %}
		{% set acc = app.session.get('user') %}
		
		{% if ustats.success is defined and ustats.success == 'true' %}
		<p class="stats">your stats:   disk usage:  {{ustats.total_filesize}}   files: {{ustats.file_count}}   pastes: {{ustats.paste_count}}</p>
		{% endif %}
		<p class="separator">---------------------------------------------------------------------------------------------------------------------------</p>
		<p>here are your files, {{acc.username}}.</p>
			{% if curr_page is defined and page_amount > 0 %}
				{% if curr_page > 1 %}
					<a href="{{curr_page-1}}">&lt&lt </a>
				{% else %}
					&lt&lt
				{% endif %}
				
				{% for page in range (0, page_amount+1) %}
					{%if page+1 == curr_page %}
						{{page+1}}
					{% else %}
						<a href="{{page+1}}">{{page+1}}</a>
					{% endif %}
				{% endfor %}
				
				{% if curr_page <= page_amount %}
					<a href="{{curr_page+1}}"> &gt&gt</a>
				{% else %}
					&gt&gt
				{% endif %}
			{% endif %}	
		</p>
		{% if ufiles.files|length > 0 %}
			<a href="/delete/all" onclick="return confirm('Do you REALLY want to delet all of your files?')">delete all files (cannot be undone!)</a>
			<table class="files">
				<thead>
					<th>filename</th>
					<th>filetype</th>
					<th></th>
				</thead>
				
					{% for file in ufiles.files %}
						<tr>
							{% if file.org_filename is defined %} 
								{#backwards compatibility#}
								<td class="filename"><a class="link" href="/u/{{file.filename}}.{{file.filetype}}"><span title="{{file.org_filename}}">{{file.org_filename}}</span></a></td>
							{% else %}
								
								<td class="filename"><a class="link" href="/u/{{file.filename}}.{{file.filetype}}"><span title="{{file.filename}}">{{file.filename}}</span></a></td>
							{% endif %}
							
							<td>{{file.filetype}}</td>
							<td><a href="/files/delete/{{file.filename}}">delete</a></td>
						</tr>
					{% endfor %}
			</table>
		{% else %}
			<p>you don't have any files</p>
		{% endif %}
	
	{% else %}
		<p>not logged in.</p>
	{% endif %}
	
	<img src="" id="thumbnail">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script>
		function checkURL(url) {
			return(url.match(/\.(jpeg|jpg|gif|png|tiff)$/) != null);
		}
		
		var $thumb = $("#thumbnail"); 
		$(document).mousemove(function(e) { 
			$thumb.offset({ top: e.pageY+10, left: e.pageX+10 }); 
		});
		
		$('.link').mouseover(function() {
			if (checkURL(this.href)){
				$("#thumbnail").attr("src",this.href);
			}
		});
		$('.link').mouseleave(function() {
			$("#thumbnail").attr("src", "");
		});
		
		
	</script>
	
	 
	
	
{% endblock %}

